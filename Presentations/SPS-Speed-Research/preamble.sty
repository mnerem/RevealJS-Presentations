% load packages
\usepackage[super]{nth}
\usepackage{colortbl}    % 
\usepackage{cancel}      % math cancel command
\usepackage{multimedia}  % allows embedding of movies or gifs into presentation (access through pympress)
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{siunitx}
\DeclareSIUnit \parsec {pc}
\DeclareSIUnit \lightyear {ly}
\usepackage{chemformula}
\usepackage{wasysym} % astronomy symbols
\usepackage[absolute,overlay]{textpos} % used to place figures over slide at desired position
\usepackage{pgfpages} % needed for notes processing
\usepackage[skins]{tcolorbox}
\usepackage[export]{adjustbox}

% allow no indent of bullet points
\usepackage{enumitem}
\setitemize{label=\usebeamerfont*{itemize item}%
  \usebeamercolor[fg]{itemize item}
  \usebeamertemplate{itemize item}}
\def\labelenumi{\theenumi} %to fix broken enumerate package

% Custom colors
\definecolor{OPBlue}{RGB}{0,55,132}
\definecolor{PerryRed}{rgb}{.863,.314,.314}
\definecolor{PerryGreen}{rgb}{.06,.66,.49}
\definecolor{PerryBlue}{rgb}{.314,.573,.863}
\definecolor{QuestionBlue}{rgb}{.2,.2,.702}
\definecolor{LinePaperBlue}{rgb}{.63,.79,.86}
\newcommand{\blue}[1]{\textcolor{PerryBlue}{#1}}
\newcommand{\red}[1]{\textcolor{PerryRed}{#1}}
\newcommand{\green}[1]{\textcolor{PerryGreen}{#1}}

\graphicspath{{./Figures/}{./Figures/Ch\CHAPTER/}{./Figures/Ch0\CHAPTER/}}
\DeclareGraphicsExtensions{.eps,.ps,.jpg,.jpeg,.gif,.pdf,.eps.gz,.ps.gz,.png}
\setbeamercolor{section in head/foot}{use=structure,bg=structure.fg!25!bg}
% Set the theme of the frames (modified Singapore theme)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\DeclareOptionBeamer{compress}{\beamer@compresstrue}
\ProcessOptionsBeamer
\mode<presentation>
\setbeamercolor{section in head/foot}{use=structure,bg=structure.fg!25!bg}
%\useoutertheme[subsection=false]{miniframes}
\setbeamertemplate{frametitle}[default][left]
\AtBeginDocument{%
  {
    \usebeamercolor{section in head/foot}
  }
  
  \pgfdeclareverticalshading{beamer@headfade}{\paperwidth}
  {%
    color(0cm)=(bg);
    color(1.25cm)=(section in head/foot.bg)%
  }

  \setbeamercolor{section in head/foot}{bg=}
}
\addtoheadtemplate{\pgfuseshading{beamer@headfade}\vskip-1.25cm}{}
\beamertemplatedotitem
\mode
<all>
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Moves dots of each section to same line as section number
\makeatletter
\patchcmd{\slideentry}{\advance\beamer@tempdim by -.05cm}{\advance\beamer@tempdim by\beamer@vboxoffset\advance\beamer@tempdim by\beamer@boxsize\advance\beamer@tempdim by 1.2\pgflinewidth}{}{}
\patchcmd{\slideentry}{\kern\beamer@tempdim}{\advance\beamer@tempdim by 2pt\advance\beamer@tempdim by\wd\beamer@sectionbox\kern\beamer@tempdim}{}{}
\makeatother
\beamertemplatenavigationsymbolsempty

% Modify footer
\makeatother
\setbeamertemplate{footline}{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=\paperwidth,ht=3.65ex,dp=1.20ex]{frametitle}%
    {%
     \footnotesize{~ODU--SPS 2021 \hspace{.25in} Hamiltonian Topological Optics}%
     \hspace*{0pt}\hfill \insertframenumber{} / \inserttotalframenumber ~%
    }
  \end{beamercolorbox}%
}%
}
\makeatletter

% Change Color of frame title
\newcommand{\PerryThemeColor}[0]{OPBlue}
\newcommand{\PerryFontColor}[0]{white}
\setbeamercolor{frametitle}{fg=\PerryFontColor,bg=\PerryThemeColor}
\setbeamercolor{section in head/foot}{fg=\PerryFontColor,bg=\PerryThemeColor}
\setbeamercolor{title}{fg=\PerryFontColor,bg=\PerryThemeColor}
\setbeamercolor{palette primary}{fg=\PerryFontColor,bg=\PerryThemeColor} % Frame title color
\setbeamercolor{footline}{fg=\PerryFontColor,bg=\PerryThemeColor} % Frame title color


% Set up title page
% Define functions for the title slide
\date{}
\newcommand{\MAKETITLESLIDE}{
    {
    \setbeamercolor{background canvas}{bg=\PerryThemeColor}
    \begin{frame}[plain]
    \advance\textwidth-35pt
    \hsize\textwidth
    \columnwidth\textwidth
      \titlepage
        \centering
    \end{frame}
    }
}

%\renewcommand\fbox{\fcolorbox{green}{white}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\QUESTIONICON}[0]{
    \begin{textblock*}{.95cm}(13.85cm,1.25em)
        \includegraphics[width=.95\textwidth]{Q-Icon.pdf}
    \end{textblock*}
}

% Define question list environment
\usepackage{ifthen}
\newcounter{qcounter}
\newenvironment{question}[1]{
    \QUESTIONICON
    \begin{tcolorbox}[
        colback=PerryBlue!5,
        colframe=PerryBlue,
        coltitle=red,
        rounded corners,
        opacityframe=.25,
        title={\begin{itemize}[leftmargin=1pt] 
                   \item[\textcolor{QuestionBlue}{Q}]{#1} \end{itemize}}
    ]
    \begin{list}{\textcolor{QuestionBlue}{(\Alph{qcounter})}}{\usecounter{qcounter}}
}{
    \end{list}
    \end{tcolorbox}
}
\newcommand{\ans}[1]{%
    \ifthenelse{\equal{\PrintAnswers}{True}}{\alert{\uppercase{#1}}}{#1}
}


% Define command to get demo-icon in the correct place
\newcommand{\DEMOICON}{
    \begin{textblock*}{1.45cm}(13.45cm,1.25em)
        \href{https://www.smbc-comics.com/comic/2009-06-02}
        {\includegraphics[height=.90cm]{Demo-Icon.pdf}}
    \end{textblock*}
}

% Tight bounding box for images
\newenvironment{tightbox}{
    \begin{tcolorbox}[
        enhanced, clip upper,
        boxsep=0pt,
        left=0pt,
        right=0pt,
        top=0pt,
        bottom=0pt,
    ]
}{
    \end{tcolorbox}
}


% Fix to have text top align in columns
\makeatletter
\define@key{beamerframe}{t}[true]{% top
  \beamer@frametopskip=.2cm plus .5\paperheight\relax%
  \beamer@framebottomskip=0pt plus 1fill\relax%
  \beamer@frametopskipautobreak=\beamer@frametopskip\relax%
  \beamer@framebottomskipautobreak=\beamer@framebottomskip\relax%
  \def\beamer@initfirstlineunskip{}%
}
\makeatother

% Change color of bullet points
\setbeamertemplate{itemize item}[circle]
%\setbeamertemplate{itemize subitem}[triangle]
%\setbeamercolor{itemize item}{fg=yellow!90!black}
%\setbeamercolor{itemize subitem}{fg=PerryBlue}

% Make easy section commands
\newcommand{\SectionPart}[2]{
    \section[\CHAPTER.\thesection]{#1}
    \begin{frame}{Outline}
        \tableofcontents[currentsection]
        \begin{textblock*}{.45\textwidth}(8.75cm,1.75cm)
            #2
        \end{textblock*}
    \end{frame}
}
\newcommand{\MakeTableOfContents}[1]{
    \begin{frame}{Outline}
        \tableofcontents
        \begin{textblock*}{.45\textwidth}(7.75cm,1.75cm)
            #1
        \end{textblock*}
    \end{frame}
}


% 1 on 1 with notes
%  --------------------------
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% | %%%%%%%%%%%%%%%%%%%%%%%% | 
% |                          | 
% | ________________________ | 
% | ________________________ | 
% | ________________________ | 
% | ________________________ | 
% | ________________________ | 
% | ________________________ | 
% | ________________________ | 
%  --------------------------
\pgfpagesdeclarelayout{1 on 1 with notes} {
	\edef\pgfpageoptionheight{\the\paperwidth}
	\edef\pgfpageoptionwidth{\the\paperheight}
	\edef\pgfpageoptionborder{0pt}
}
{
	\pgfpagesphysicalpageoptions
	{%
		logical pages=2,%
		physical height=\pgfpageoptionheight,%
		physical width=\pgfpageoptionwidth,%
		last logical shipout=1%
	}
	
	\pgfpageslogicalpageoptions{1}
	{%
		border shrink=\pgfpageoptionborder,%
		resized width=\pgfphysicalwidth,%
		resized height=.5\pgfphysicalheight,%
		center=\pgfpoint{.5\pgfphysicalwidth}{.75\pgfphysicalheight}%
	}%
	
	\pgfpageslogicalpageoptions{2}
	{%
		border shrink=\pgfpageoptionborder,%
		resized width=\pgfphysicalwidth,%
		resized height=.5\pgfphysicalheight,%
		center=\pgfpoint{.5\pgfphysicalwidth}{.25\pgfphysicalheight},%
		copy from=2
	}%    
	
    \newcommand{\NotesLineSep}{.01\paperheight}
	\AtBeginDocument{
		\newbox\notesbox
		\setbox\notesbox=\vbox{
			\hsize=\paperwidth
			\vskip-1in\hskip-1in\vbox{
                % print a line \foo number of times
                \newcount\foo
                \foo=19
                \loop
                    %\hrule width\paperwidth\vskip\NotesLineSep
                    \textcolor{LinePaperBlue}{\rule{\paperwidth}{.1pt}} \vskip\NotesLineSep
                    \advance \foo -1
                \ifnum \foo>0
                \repeat
			}
		}
		\pgfpagesshipoutlogicalpage{2}\copy\notesbox
	}
}


% Define what the output should be
\usepackage{etoolbox} % access to programming tools
% \ifdef{<control sequence>}{<true>}{<false>}
\ifdef{\StudentHandout}{
%    \logo{}
%    \setbeamercolor{logo}{bg=black!2}
%    \renewcommand{\PerryThemeColor}{black!2}
%    \renewcommand{\PerryFontColor}{black}
%    \setbeamercolor{background canvas}{bg=black!2}
    \pgfpagesuselayout{1 on 1 with notes}[letterpaper,border shrink=5mm]
    \newcommand{\PrintAnswers}{False}%
}{%
    \newcommand{\PrintAnswers}{True}%
}

\ifdef{\InstructorNotes}{
%    \logo{}
%    \setbeamercolor{logo}{bg=black!2}
%    \renewcommand{\PerryThemeColor}{black!2}
%    \renewcommand{\PerryFontColor}{black}
    \setbeameroption{show notes}
    \setbeameroption{show notes on second screen=right}
    \setbeamertemplate{note page}[plain]
%    \pgfpagesuselayout{4 on 1}[letterpaper,border shrink=5mm,landscape]
    \renewcommand{\PrintAnswers}{True}
}{%
    \renewcommand{\PrintAnswers}{False}
}%

